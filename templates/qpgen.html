{% extends 'base.html' %}

{% block section %}

<style>

    *{
        outline: red 1px solid;
    }
    .container {
        background-color: white;
        display: flex;
        max-height: 84dvh;
        
        margin: 2%;
        border-radius: 20px;
        box-shadow: 0 2px 3px rgba(0, 0, 0, 0.5);

    }

    .question-item {
        display: flex;
        margin-bottom: 10px; /* Add some space between each question item */
    }

    .question-content {
        display: flex;
        align-items: center; /* Align the image and text vertically */
        gap: 10px; /* Space between the image and the question info */
    }

    .thumbnail {
        width: 5dvw; height: 5dvw; 
        flex-shrink: 0; 
    }

    .thumbnail > img {
        width: 100%;  /* Make the image fill the container */
        height: 100%; /* Maintain the aspect ratio */
        object-fit: cover; /* Ensure the image doesn't distort */
    }

    .question-info {
        font-size: large;
    }

    .container-sidebar {
        max-width: 30dvw;
        margin: 1dvw;
    }


</style>

<div class="container">
    <div class="container-sidebar">
        <h2 style="margin: 2dvh; font-size: x-large;">{{rows|length}} Questions Successfully Generated</h2>
        <div class="question-list">
            {% for row in rows %}
            <div class="question-item">
                <div class="question-content">
                    <div class="question-image thumbnail" id="{{row.1}}" data-compressed="{{ row[8] }}">
                        <!-- You can add the img tag here if needed -->
                    </div>
                    <div class="question-info">
                        <h4>Topic: {{row.3}}</h4>
                        <h5>Province: {{row.7}}</h5>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="content">
        {% for row in rows %}
        <!-- <div class="question-container" id="question-container-{{ loop.index }}">
            <div class="question-image" id="question-image-{{ loop.index }}" data-compressed="{{ row[8] }}"></div>
            <div class="solution-container" id="solution-container-{{ loop.index }}">
                <div class="solution-image" id="solution-image-{{ loop.index }}" data-compressed="{{ row[9] }}"></div>
                <button class="toggle-question" data-question-id="{{ loop.index }}">Show Question</button>
            </div>
        </div> -->
        {% endfor %}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        function renderImageFromElement(element, base64Data) {
            if (!element || !base64Data) {
                console.error("Element or data not found");
                return;
            }

            try {
                // Decode the base64 string to binary
                const binaryString = atob(base64Data);
                const charData = binaryString.split('').map(char => char.charCodeAt(0));
                const uint8Array = new Uint8Array(charData);

                // Decompress the data using pako
                const decompressedData = pako.inflate(uint8Array);

                // Create a Blob from the decompressed data
                const blob = new Blob([decompressedData], { type: 'image/png' });
                const imageUrl = URL.createObjectURL(blob);
                
                // Create an image element and set the source
                const imgElement = document.createElement('img');
                imgElement.src = imageUrl;
                element.textContent = '';
                element.appendChild(imgElement);
            } catch (error) {
                console.error(`Failed to render image for element ID ${element.id}:`, error);
            }
        }

        // Find all question images
        const questionImages = document.querySelectorAll('.question-image');
        const solutionImages = document.querySelectorAll('.solution-image');

        // Render images for each question and solution
        questionImages.forEach((element) => {
            const base64Data = element.getAttribute('data-compressed');
            renderImageFromElement(element, base64Data);
        });

        solutionImages.forEach((element) => {
            const base64Data = element.getAttribute('data-compressed');
            renderImageFromElement(element, base64Data);
        });

    });
</script>
{% endblock %}
